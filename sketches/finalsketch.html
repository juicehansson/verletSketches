!DOCTYPE html>
<html lang="en">

<head>
    <title>MySketch</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./../../css/style.css" type="text/css" media="screen, projection" />
    <link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="./../../js/verlet-1.0.0.js"></script>
    <style type="text/css" media="screen">
        canvas,
        img {
            display: block;
            margin: 1em auto;
            border: 1px solid black;
        }

        canvas {
            background: url("")
        }
    </style>
</head>

<body>
    <script type="text/javascript" src="./../../site/js/common.js"></script>
    <h1>
        Annas sketch 1
    </h1>
    <h4>Author</h4>
    <a href="https://github.com/Annabjoerk" target="_blank">Anna Bj√∂rk</a>

    <center>
        Final sketch
        <br>
        <br>
        <br>
        <br>
        <a href="https://www.sitepoint.com/an-introduction-to-verlet-js/" target="_blank">Tutorial I used </a>
    </center>

    <canvas width="700" height="500" id="canvas"></canvas>

    <script type="text/javascript">
        var world;
        
        var fortuneWheel = new Audio("prize-wheel.wav");
        var audioContext = window.AudioContext || window.webkitAudioContext;
        var audioCtx = new AudioContext();
        var gainNode = audioCtx.createGain();
        var oscillator = audioCtx.createOscillator();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        var WIDTH = VerletJS.width;
        var HEIGHT = VerletJS.height;

        var maxFreq = 3000;
        var maxVol = 0.02;

        var initialFreq = 500;
        var initialVol = 0.02;

        oscillator.detune.value = 100;

        gainNode.gain.value = initialVol;
        oscillator.frequency.value = initialFreq;


        var CurX;
        var CurY;

        
        

        function initializeWorld() {
            world = new VerletJS(700, 500, document.getElementById("canvas"));
            //calling the verlet constructor

            //Front wheel
            var wheel = world.tire(new Vec2(350, 250), 80, 30, 1, 1);

            var pin = wheel.pin(30);


            //Flag 1
            world.cloth(new Vec2(100, 200), 150, 200, 16, 3, 1);

            //Flag 2
            world.cloth(new Vec2(600, 200), 150, 200, 16, 3, 1);

            //Rope

            var rope = world.lineSegments([
                new Vec2(450, 200),
                new Vec2(460, 100),
                new Vec2(470, 100),
                new Vec2(480, 100)
            ], 1);
            var pin = rope.pin(0);

            //---GRAVITY---
            //  world.gravity = new Vec2(0.0, 0.5);

            //---JOSEFINE---
            function handleOrientation(event) {
                var x = event.beta; // In degree in the range [-180,180]
                var y = event.gamma; // In degree in the range [-90,90]
                var z = event.alpha; // In degree in the range [-90,90]

                if (event.beta < 70 && event.alpha > 100) {
                    //alpha goes from 0-300
                    //console.log(event.alpha)
                    world.gravity = new Vec2(0.1, 0.3);
                } else if (event.beta < 70 && event.alpha < 100) {
                    //alpha goes from 0-140
                    //console.log(event.alpha)
                    world.gravity = new Vec2(-0.1, 0.3);
                } else {
                    //---GRAVITY---
                    world.gravity = new Vec2(0.0, 0.5);
                }

            }

            window.addEventListener('deviceorientation', handleOrientation);


        }

        var fps = 32;
        var _this = this;
        VerletJS.onmousemove = updatePage;

        this.canvas.onmousemove = function (e) {
            var rect = _this.canvas.getBoundingClientRect();
            _this.mouse.x = e.clientX - rect.left;
            _this.mouse.y = e.clientY - rect.top;
        };

        function updatePage(e) {
            CurFlag = false;

            CurX = (VerletJS.Event) ? e.pageX : event.clientX + (VerletJS.canvas.scrollLeft ? VerletJS.canvas.scrollLeft :
                document.body.scrollLeft);
            CurY = (VerletJS.Event) ? e.pageY : event.clientY + (VerletJS.scrollTop ? VerletJS.canvas.scrollTop :
                document.body.scrollTop);
            //canvas.oscillator.start(0);
            oscillator.frequency.value = (CurX / WIDTH) * maxFreq;
            //oscillator.frequency.value = (CurY/HEIGHT) * maxFreq;
            //gainNode.gain.value = (CurX/WIDTH) * maxVol;
            gainNode.gain.value = (CurY / HEIGHT) * maxVol;
            //canvas.addEventListener("dragstart", function() {
            //oscillator.start(0);

            //})
        }

        function renderWorld() {
            world.frame(16); //performs the physics calculations
            world.draw(); //draws the particles and constrains
            setTimeout(renderWorld, 1000 / fps); //how often if calls the rendering
        }



        //calling the initializing and the rendering on "load"
        window.addEventListener("load", function () {
            initializeWorld();
            renderWorld();
        });

        canvas.addEventListener("mousemove", mousemove);
        canvas.addEventListener("mousedown", mousedown);
        canvas.addEventListener("mouseup", mouseup);

        function mousemove(e) {
            CurX = e.layerX - canvas.offsetLeft;
            CurY = e.layerY - canvas.offsetTop;
            if ((mousedown && mousemove), true) {
                oscillator.detune.value = 200;
            }
        }
        
        function mousedown(e) {
           
            oscillator.start();
            
        }

        function mouseup(e) {
            oscillator.stop();
            oscillator.disconnect();
            fortuneWheel.play();
            
        }

    </script>
    <div id="footer">
        Copyright 2013 Sub Protocol and other contributors.
        <br/>
        <a href="http://subprotocol.com/">http://subprotocol.com/</a>
    </div>
</body>